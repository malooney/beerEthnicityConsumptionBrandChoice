---
title: "Lab Notebook for: \n beerEthnicityConsumptionBrandChoice"
author: "Matthew Aaron Looney"
date: "7/31/2018"
output: 
  pdf_document: 
    fig_caption: yes
    toc: yes
    toc_depth: 4
header-includes:
- \usepackage{graphicx}
- \usepackage{rotating}
- \usepackage{longtable}
- \usepackage{amssymb,amsmath}
- \usepackage{dcolumn}
- \usepackage{setspace}
- \usepackage{mathrsfs}
- \usepackage{eso-pic,graphicx,transparent}
fontsize: 10pt
geometry: margin = 1.25in
---

\newpage
  
```{r echo=F, warning=F, message=F}

library(knitr)
library(kableExtra)
library(beerEthnicityConsumptionBrandChoice)

path.local <- rprojroot::find_rstudio_root_file()

```
  
# S1.beer_2010DataCleaning - Process raw beer data

```{r echo=F, cache=T, message=F, warning=F}

hora <- S1.beer_2010DataCleaning(save_2010_main_data = 'all_formats',
                                 out_algoRunTime = T)

```
  
\begin{verbatim}
Algorithm name: S1.beer_2010DataCleaning(save_2010_main_data = 'all_formats',
                                         out_algoRunTime = T)
\end{verbatim}
                            
Algorithm run time: `r difftime(hora[[2]], hora[[1]], units="min") ` minute(s).   
\newpage

# S2.construct_2010marketData - Partition the cleaned data by city

```{r echo=F, cache=T, message=F, warning=F}

hora <- S2.construct_2010marketData(input_fileType = 'feather',
                                    marketNames = c('all'),
                                    out_algoRunTime = T)

```
  
\begin{verbatim}
Algorithm name: S2.construct_2010marketData(input_fileType = 'feather',
                                            marketNames = c('all'),
                                            out_algoRunTime = T)
\end{verbatim}
                            
Algorithm run time: `r difftime(hora[[2]], hora[[1]], units="min") ` minute(s).   
\newpage

#S3.explore_2010marketData - Explore the completeness of the data

This algorithm takes city level data and determines, by brand, if there are any weeks over a 52 week period (one year) that a brand is missing in the data. If there are missing weeks in the data it is impossible to tell if there were no sales of a particular brand during that week or if the brand was not offered for sale. All we can see is that the week is missing data. Further, this algorithm determines the completeness of the data at the chain level. The same problem occurs when evaluating missing data at the chain level. It is not possible to say why the data is missing, simply that the data is missing.  

The output of the algorithm presents a data file called: D3.explore_2010marketData.rds

This files contains information on missingness in the data by city / brand / week / chain.

Several data frames are contained in the list. 

  * BrandsOnly_CompleteData_wks: contains a list of brands with complete data over all 52 weeks.
  
  * explore_Data_Complete_wks: contains the raw data.frame for the brands with complete data over all 52 weeks.
  
  * Brands_CompleteData_wksANDChains: contains a list of brands with complete data over all 52 weeks and complete data over all chains in the city. The number of chains is variable depending on the city.
  
  * explore_Data_Complete_wksANDChains: contains the raw data.frame for the brands with complete data over all 52 weeks and chains with complete data over all chains.
  
  * explore_Data: contains the complete raw data.frame used to obtain the above filtered results.

```{r echo=F, cache=T, message=F, warning=F}

hora <- S3.explore_2010marketData(out_algoRunTime = T)

```
  
\begin{verbatim}
Algorithm name: S3.explore_2010marketData(out_algoRunTime = T) 
\end{verbatim}
                            
Algorithm run time: `r difftime(hora[[2]], hora[[1]], units="min") ` minute(s).   
\newpage

# S4.allBrands_2010analysis - 

```{r echo=F, cache=T, message=F, warning=F}

hora <- S4.allBrands_2010analysis( brands= c("CHICAGO", 
                                             "DALLAS, TX", 
                                             "LOS ANGELES", 
                                             "SPOKANE", 
                                             "SYRACUSE", 
                                             "HOUSTON"), 
                                    out_algoRunTime = T
                                  )

```
  
\begin{verbatim}
Algorithm name: S4.allBrands_2010analysis(brands= c("CHICAGO", 
                                                    "DALLAS, TX", 
                                                    "LOS ANGELES", 
                                                    "SPOKANE", 
                                                    "SYRACUSE", 
                                                    "HOUSTON"), 
                                          out_algoRunTime = T
                                          )  
\end{verbatim}
                            
Algorithm run time: `r difftime(hora[[2]], hora[[1]], units="min") ` minute(s).   
\newpage

# S5.aggregate_allBrands_2010 - 

## City: CHICAGO
  
```{r echo=F, cache=T, message=F, warning=F, fig.height=8, fig.width=9}

par(mfrow= c(1, 2), ps= 8, cex= 0.75, cex.main= 1.25)

hora <- S5.aggregate_allBrands_2010(Market = 'CHICAGO', 
                                    figurePlot = T,
                                    screenPlot = F,
                                    saveData = T, 
                                    out_algoRunTime = T)

Market <- "CHICAGO"

dta <- readRDS(paste(path.local, "/data_beerEthnicityConsumptionBrandChoice/D5.aggregate_allBrands_2010_", gsub('[ ,]', '', Market), ".rds", sep = ""))

```
  
\begin{verbatim}
Algorithm name: S5.aggregate_allBrands_2010(Market = 'CHICAGO', 
                                            figurePlot = T,
                                            screenPlot = T,
                                            saveData = T, 
                                            out_algoRunTime = T)  
\end{verbatim}
                            
Algorithm run time: `r difftime(hora[[2]], hora[[1]], units="min") ` minute(s).   
  
prcntBrandRep_units: `r dta[[1]][1] `%.

prcntBrandRep_dol: `r dta[[1]][2] `%.

prcntBrandRep_gal: `r dta[[1]][3] `%.

prcntFirmRep_units: `r dta[[2]][1] `%.

prcntFirmRep_dol: `r dta[[2]][2] `%.

prcntFirmRep_gal: `r dta[[2]][3] `%.

prcntConglomerateRep_units: `r dta[[3]][1] `%.

prcntConglomerateRep_dol: `r dta[[3]][2] `%.

prcntConglomerateRep_gal: `r dta[[3]][3] `%.
  
  
\newpage
  
```{r echo=F, cache=F, message=F, warning=F, results='asis'}

 knitr::kable(
   dta[["aggregateConglomerates"]][["aggregateDataSummaryConglomerates"]], 
   caption="Aggregate Conglomerate Data for CHICAGO", 
   booktabs = T, 
   linesep = "") %>%
kableExtra::kable_styling(latex_options = c("striped", "hold_position"), 
                          full_width = NULL) %>%
kableExtra::footnote(general="Aggregate Conglomerate Data for CHICAGO")


```
  
  
```{r echo=F, cache=F, message=F, warning=F, results='asis'}

knitr::kable(dta[["aggregateFirms"]][["aggregateDataSummaryFirms"]], 
             caption="Aggregate Firm Data for CHICAGO", 
             booktabs = T, 
             linesep = "") %>%
kableExtra::kable_styling(latex_options = c("striped", "hold_position"),
                          full_width = NULL) %>%
kableExtra::footnote(general=c(paste("Number of firms: ", nrow(dta[["aggregateFirms"]][["aggregateDataSummaryFirms"]])), 
                                   "Aggregate Firm Data for CHICAGO", sep=""))

```
  
  
```{r echo=F, cache=F, message=F, warning=F, results='asis'}

knitr::kable(dta[["aggregateBrands"]][["aggregateDataSummaryBrands"]], 
             caption="Aggregate Brand Data for CHICAGO", 
             booktabs = T, 
             longtable=T, 
             linesep = "") %>%
kableExtra::kable_styling(latex_options = "striped", 
                          full_width = NULL) %>%
kableExtra::footnote(general="Aggregate Brand Data for CHICAGO")

```

\newpage

\begin{sidewaysfigure}
\begin{center}
\includegraphics [height=20cm]{`r paste(path.local, "/data_beerEthnicityConsumptionBrandChoice/plots/plot.aggregateData_CHICAGO.pdf", sep="") `}
\caption{Plot of Aggregate Data for Chicago}
\end{center}
\end{sidewaysfigure}







## City: DALLAS, TX

```{r echo=F, cache=T, message=F, warning=F, fig.height=8, fig.width=9}

par(mfrow= c(1, 2), ps= 8, cex= 0.75, cex.main= 1.25)

hora <- S5.aggregate_allBrands_2010(Market = 'DALLAS, TX',
                                    figurePlot = T,
                                    screenPlot = F,
                                    saveData = T,
                                    out_algoRunTime = T)

Market <- "DALLAS, TX"

dta <- readRDS(paste(path.local, "/data_beerEthnicityConsumptionBrandChoice/D5.aggregate_allBrands_2010_", gsub('[ ,]', '', Market), ".rds", sep = ""))

```

\begin{verbatim}
Algorithm name: S5.aggregate_allBrands_2010(Market = 'DALLAS, TX',
                                            figurePlot = T,
                                            screenPlot = F,
                                            saveData = T,
                                            out_algoRunTime = T)
\end{verbatim}

Algorithm run time: `r difftime(hora[[2]], hora[[1]], units="min") ` minute(s).  
  
prcntBrandRep_units: `r dta[[1]][1] `%.

prcntBrandRep_dol: `r dta[[1]][2] `%.

prcntBrandRep_gal: `r dta[[1]][3] `%.

prcntFirmRep_units: `r dta[[2]][1] `%.

prcntFirmRep_dol: `r dta[[2]][2] `%.

prcntFirmRep_gal: `r dta[[2]][3] `%.

prcntConglomerateRep_units: `r dta[[3]][1] `%.

prcntConglomerateRep_dol: `r dta[[3]][2] `%.

prcntConglomerateRep_gal: `r dta[[3]][3] `%.
  
  
\newpage
  
```{r echo=F, cache=T, message=F, warning=F, results='asis'}

 knitr::kable(
   dta[["aggregateConglomerates"]][["aggregateDataSummaryConglomerates"]], 
   caption="Aggregate Conglomerate Data for DALLAS, TX", 
   booktabs = T, 
   linesep = "") %>%
kableExtra::kable_styling(latex_options = c("striped", "hold_position"), 
                          full_width = NULL) %>%
kableExtra::footnote(general="Aggregate Conglomerate Data for DALLAS, TX")

```
  
  
```{r echo=F, cache=F, message=F, warning=F, results='asis'}

knitr::kable(dta[["aggregateFirms"]][["aggregateDataSummaryFirms"]], 
             caption="Aggregate Firm Data for DALLAS, TX", 
             booktabs = T, 
             linesep = "") %>%
kableExtra::kable_styling(latex_options = c("striped", "hold_position"),
                          full_width = NULL) %>%
kableExtra::footnote(general=c(paste("Number of firms: ", nrow(dta[["aggregateFirms"]][["aggregateDataSummaryFirms"]])), 
                                   "Aggregate Firm Data for DALLAS, TX", sep=""))

```
  
  
```{r echo=F, cache=F, message=F, warning=F, results='asis'}

knitr::kable(dta[["aggregateBrands"]][["aggregateDataSummaryBrands"]], 
             caption="Aggregate Brand Data for DALLAS, TX", 
             booktabs = T, 
             longtable=T, 
             linesep = "") %>%
kableExtra::kable_styling(latex_options = "striped", 
                          full_width = NULL) %>%
kableExtra::footnote(general="Aggregate Brand Data for DALLAS, TX")

```

\newpage

\begin{sidewaysfigure}
\begin{center}
\includegraphics [height=20cm]{`r paste(path.local, "/data_beerEthnicityConsumptionBrandChoice/plots/plot.aggregateData_DALLASTX.pdf", sep="") `}
\caption{Plot of Aggregate Data for Dallas, TX}
\end{center}
\end{sidewaysfigure}

\newpage
